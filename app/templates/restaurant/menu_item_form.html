{% extends "base.html" %}

{% block title %}{{ form_action_title }} - Skyking{% endblock %}

{% block content %}
<div class="container page-padding">
    {# Botón para volver a la gestión del menú de ESTE restaurante #}
    <a href="{{ url_for('restaurant.manage_menu', restaurant_id=restaurant.id) }}" class="btn btn-outline-secondary mb-3" style="color:#00D9C0; border-color:#00D9C0; text-decoration: none; display: inline-block; padding: 8px 15px; margin-bottom:20px;">&laquo; Volver a Gestionar Menú</a>

    <h1>{{ form_action_title }}</h1>
    {# <p class="lead">Restaurante: {{ restaurant.name }}</p> #}

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div style="margin-bottom: 20px;">
            {% for category, message in messages %}
                {% set border_color = '#00D9C0' %} 
                {% if category == 'danger' %}{% set border_color = '#dc3545' %}{% endif %}
                {% if category == 'success' %}{% set border_color = '#28a745' %}{% endif %}
                <div class="alert alert-{{ category if category != 'message' else 'info' }}" role="alert" 
                     style="background-color: #333; color: #fff; padding: 10px; margin-bottom:10px; border-left: 5px solid ;">
                    {{ message }}
                </div>
            {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="card" style="background-color: #1E1E1E; padding: 25px; border-radius: 8px; max-width: 700px; margin: 0 auto;">
        {# El action será la URL actual (para GET y POST a la misma ruta) o una específica si es para editar #}
        <form method="POST" action="" enctype="multipart/form-data"> 
            {# Podrías añadir {{ form.csrf_token }} si usas Flask-WTF #}
            
            <div class="form-group mb-3">
                <label for="name">Nombre del Ítem:</label>
                <input type="text" class="form-control" id="name" name="name" 
                       value="{{ item_data.get('name', '') }}" required
                       style="background-color: #2A2A2A; color: #E0E0E0; border: 1px solid #444;">
            </div>

            <div class="form-group mb-3">
                <label for="description">Descripción:</label>
                <textarea class="form-control" id="description" name="description" rows="3"
                          style="background-color: #2A2A2A; color: #E0E0E0; border: 1px solid #444;">{{ item_data.get('description', '') }}</textarea>
            </div>

            <div class="form-group mb-3">
                <label for="price">Precio ($):</label>
                <input type="number" step="0.01" min="0" class="form-control" id="price" name="price" 
                       value="{{ item_data.get('price', '') }}" required
                       style="background-color: #2A2A2A; color: #E0E0E0; border: 1px solid #444;">
            </div>

            <div class="form-group mb-3">
                <label for="menu_item_image">Imagen del Ítem:</label>
                {# Si se está editando y ya hay una imagen, mostrarla #}
                {% if item_data and item_data.image_url %}
                    <div style="margin-bottom: 10px;">
                        <p style="font-size: 0.9em; color: #A0A0A0;">Imagen actual:</p>
                        <img src="{{ url_for('static', filename=item_data.image_url) }}" alt="Imagen actual de {{ item_data.name }}" style="max-height: 100px; border-radius: 4px; border: 1px solid #444;">
                        <p style="font-size: 0.8em; color: #A0A0A0; margin-top:5px;">Sube una nueva imagen para reemplazarla.</p>
                    </div>
                {% endif %}
                <input type="file" class="form-control-file" id="menu_item_image" name="menu_item_image" accept="image/png, image/jpeg, image/gif"
                    style="background-color: #2A2A2A; color: #E0E0E0; border: 1px solid #444; padding: 10px;">
                <small style="color: #A0A0A0; font-size: 0.85em;">Archivos permitidos: .png, .jpg, .jpeg, .gif.</small>
            </div>

            <div class="form-group form-check mb-3">
                <input type="checkbox" class="form-check-input" id="is_available" name="is_available" 
                       {% if item_data.get(is_available, true) %}checked{% endif %}
                       style="margin-top: 5px;">
                <label class="form-check-label" for="is_available" style="color: #ccc; font-weight:normal;">¿Está disponible para la venta?</label>
            </div>
            
            <button type="submit" class="btn btn-primary-custom" style="background-color: #00D9C0; color: #121212; border:none; padding: 12px 30px; font-weight: 600;">
                {% if item_data.get('id') %}Guardar Cambios{% else %}Añadir Ítem{% endif %}
            </button>
        </form>
    </div>
</div>
{% endblock %}