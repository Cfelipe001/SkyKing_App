<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crea tu Cuenta en Skyking</title>
    <style>
        /* --- Estilos basados en tu admin_register_user_form.html --- */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: #121212; 
            color: #E0E0E0; 
            line-height: 1.6; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; /* Para centrar el contenido verticalmente si es corto */
            padding-top: 20px; 
            padding-bottom: 20px; 
            min-height: 100vh;
        }
        .container { 
            width: 90%; 
            max-width: 1200px; /* Aunque el form es m√°s peque√±o */
            margin: 0 auto; 
        }
        
        .navbar { /* Navbar de ejemplo, puedes adaptarla a tu navbar p√∫blica */
            background-color: #1E1E1E; 
            padding: 15px 0; 
            border-bottom: 1px solid #333; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
            width: 100%; 
            margin-bottom: 30px; 
        }
        .navbar .container { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .navbar-brand { 
            font-size: 1.8em; 
            font-weight: 700; 
            color: #00D9C0; 
            text-decoration: none; 
        }
        .navbar-nav { 
            list-style: none; 
            display: flex; 
        }
        .navbar-nav li { 
            margin-left: 25px; 
        }
        .navbar-nav li a { 
            color: #E0E0E0; 
            text-decoration: none; 
            font-size: 1em; 
            font-weight: 500; 
            transition: color 0.3s ease; 
        }
        .navbar-nav li a:hover, .navbar-nav li a.active { 
            color: #00D9C0; 
        }
        
        h1 { 
            font-size: 1.8em; /* Ajustado para el formulario */
            color: #FFFFFF; 
            margin-bottom: 25px; 
            text-align: center; 
            font-weight: 600; 
        }
        .form-card { /* Renombrado de .card para evitar posible conflicto con otros .card si los tienes */
            background-color: #1E1E1E; 
            padding: 30px 40px; /* Padding como el que ten√≠as en account-form-container */
            border-radius: 8px; 
            box-shadow: 0 5px 25px rgba(0,0,0,0.25); /* Sombra como account-form-container */
            width:100%; 
            max-width: 450px; /* Ancho similar a tu form de login */
            margin: 20px auto; 
        }
        .form-group { 
            margin-bottom: 18px; /* Como tu login form */
            text-align: left; 
        }
        .form-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: bold; 
            color: #ccc; 
            font-size: 0.9em; /* Un poco m√°s peque√±o */
        }
        .form-group input, .form-group select { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #444; 
            border-radius: 6px; /* Como tu login form */
            box-sizing: border-box; 
            background-color: #2A2A2A; 
            color: #E0E0E0; 
            font-size: 1em; 
            -webkit-appearance: none; 
            -moz-appearance: none;
            appearance: none;
        }
         .form-group select {
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2300D9C0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E"); /* Flecha de color acento */
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: .65em auto;
            padding-right: 30px; 
        }
        .form-group select::-ms-expand { display: none; }
        .form-group input:focus, .form-group select:focus { 
            outline: none; 
            border-color: #00D9C0; 
            box-shadow: 0 0 0 0.2rem rgba(0,217,192,.25); 
        }
        .password-wrapper { position: relative; display: flex; align-items: center; }
        .password-wrapper input { padding-right: 35px; }
        .toggle-password { position: absolute; right: 10px; cursor: pointer; color: #777; user-select: none; }

        .btn-submit { /* Renombrado de .btn .btn-primary-custom o .action-button */
            background-color: #00D9C0; 
            color: #121212; 
            width: 100%;
            padding: 12px;
            border: none; 
            border-radius: 25px; 
            font-weight: 600; 
            font-size: 1.1em;
            cursor: pointer; 
            transition: background-color 0.3s ease;
            margin-top: 10px; /* Espacio antes del bot√≥n */
        }
        .btn-submit:hover { background-color: #00bfa5; }
        
        /* Mensajes de respuesta del JS */
        #responseMessages { list-style: none; padding: 0; margin: 20px 0 0 0; }
        #responseMessages li { padding: 10px 15px; margin-bottom: 10px; border-radius: 4px; font-size: 0.9em; text-align: left; }
        #responseMessages li.error { background-color: rgba(220, 53, 69, 0.2); color: #dc3545; border: 1px solid #dc3545; }
        #responseMessages li.success { background-color: rgba(40, 167, 69, 0.2); color: #28a745; border: 1px solid #28a745; }

        .alternate-link { text-align: center; font-size: 0.9em; color: #A0A0A0; margin-top: 25px; }
        .alternate-link a { color: #00D9C0; text-decoration: none; font-weight: bold; }
        .alternate-link a:hover { text-decoration: underline; }

        footer { background-color: #1E1E1E; color: #A0A0A0; text-align: center; padding: 25px 0; margin-top: 50px; border-top: 1px solid #333; width:100%;}
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="skyking_inicio_corregido.html" class="navbar-brand">Skyking</a> {# Enlace a tu p√°gina de inicio #}
            <ul class="navbar-nav">
                <li><a href="login.html">Iniciar Sesi√≥n</a></li> {# Enlace a tu p√°gina de login #}
            </ul>
        </div>
    </nav>

    <div class="container page-padding" style="display: flex; justify-content: center; align-items: flex-start; flex-grow:1;">
        <div class="form-card">
            <h1>Crear Cuenta en Skyking</h1>
            <ul id="responseMessages"></ul>

            <form id="publicRegisterForm"> 
                <div class="form-group">
                    <label for="reg_full_name">Nombre Completo:</label>
                    <input type="text" id="reg_full_name" name="full_name" required>
                </div>

                <div class="form-group">
                    <label for="reg_email">Correo Electr√≥nico:</label>
                    <input type="email" id="reg_email" name="email" required>
                </div>

                <div class="form-group">
                    <label for="reg_phone_number">N√∫mero de Tel√©fono (Opcional):</label>
                    <input type="tel" id="reg_phone_number" name="phone_number">
                </div>

                <div class="form-group">
                    <label for="reg_role">Deseo registrarme como:</label>
                    <select id="reg_role" name="role" required>
                        <option value="" disabled selected>Selecciona un tipo de cuenta...</option>
                        <option value="user">Cliente (para hacer pedidos)</option>
                        <option value="repartidor_moto">Repartidor en Motocicleta</option>
                        <option value="repartidor_bici">Repartidor en Bicicleta</option>
                        <option value="restaurant_owner">Due√±o de Restaurante / Aliado Comercial</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="reg_password">Contrase√±a:</label>
                    <div class="password-wrapper">
                        <input type="password" id="reg_password" name="password" required>
                        <span class="toggle-password" title="Mostrar/Ocultar contrase√±a" onclick="togglePasswordVisibility('reg_password', this)">üëÅÔ∏è</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="reg_confirm_password">Confirmar Contrase√±a:</label>
                    <div class="password-wrapper">
                        <input type="password" id="reg_confirm_password" name="confirm_password" required>
                         <span class="toggle-password" title="Mostrar/Ocultar contrase√±a" onclick="togglePasswordVisibility('reg_confirm_password', this)">üëÅÔ∏è</span>
                    </div>
                </div>
                
                <button type="submit" class="btn-submit">
                    Registrar Mi Cuenta
                </button>
            </form>
            <div class="alternate-link">
                ¬øYa tienes una cuenta? <a href="login.html">Inicia Sesi√≥n</a>
            </div>
        </div>
    </div>

    <footer style="position:relative; bottom:0; width:100%;"> {# Para que el footer quede abajo si el contenido es corto #}
        <div class="container">
            <p>&copy; 2025 Skyking. Todos los derechos reservados.</p>
        </div>
    </footer>

<script>
    function togglePasswordVisibility(fieldId, toggleElement) {
        const passwordField = document.getElementById(fieldId);
        if (passwordField.type === "password") {
            passwordField.type = "text";
        } else {
            passwordField.type = "password";
        }
    }

    document.getElementById('publicRegisterForm').addEventListener('submit', async function(event) {
        event.preventDefault(); 

        const form = event.target;
        const data = {};
        new FormData(form).forEach((value, key) => { data[key] = value; });

        const responseMessagesUI = document.getElementById('responseMessages');
        responseMessagesUI.innerHTML = ''; 

        if (data.password !== data.confirm_password) {
            const li = document.createElement('li');
            li.className = 'error';
            li.textContent = 'Las contrase√±as no coinciden.';
            responseMessagesUI.appendChild(li);
            return;
        }
        
        if (!data.role) { 
            const li = document.createElement('li');
            li.className = 'error';
            li.textContent = 'Debes seleccionar un tipo de cuenta.';
            responseMessagesUI.appendChild(li);
            return;
        }

        // Aseg√∫rate de enviar todos los campos que tu backend espera para create_new_user
        const dataToSend = {
            email: data.email,
            password: data.password,
            role: data.role,
            full_name: data.full_name,       // A√±adido
            phone_number: data.phone_number  // A√±adido
        };

        try {
            const response = await fetch("/register_ajax", { 
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dataToSend)
            });

            const result = await response.json(); 
            const li = document.createElement('li');

            if (response.ok) {
                li.className = 'success';
                li.textContent = result.message || '¬°Registro exitoso! Ahora puedes iniciar sesi√≥n.';
                form.reset(); 
                setTimeout(() => { 
                    window.location.href = "login.html"; 
                }, 2500); 
            } else { 
                li.className = 'error';
                let errorText = result.error || `Error: ${response.statusText} (${response.status})`;
                if (response.status === 500 && !result.error) {
                    errorText = 'Error interno del servidor. Intenta m√°s tarde.';
                    console.error("Respuesta del servidor (error 500) no fue JSON:", await response.text());
                }
                li.textContent = errorText;
            }
            responseMessagesUI.appendChild(li);

        } catch (error) { 
            console.error('Error en la solicitud fetch de registro:', error);
            const li = document.createElement('li');
            li.className = 'error';
            if (error instanceof SyntaxError) { 
                li.textContent = 'Error al procesar la respuesta del servidor.';
            } else {
                li.textContent = 'Ocurri√≥ un error de red. Intenta de nuevo.';
            }
            responseMessagesUI.appendChild(li);
        }
    });
</script>
</body>
</html>