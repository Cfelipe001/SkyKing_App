{% extends "base.html" %}

{% block title %}Tu Carrito de Compras - Skyking{% endblock %}

{% block content %}
<div class="container">
    <h1>Tu Carrito de Compras</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category if category != 'message' else 'info' }}" role="alert" style="background-color: #333; color: #fff; padding: 10px; margin-bottom:15px; border-left: 5px solid #00D9C0;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if cart_by_restaurant %}
        {% for restaurant_id, data_restaurant in cart_by_restaurant.items() %}
        <div class="card mb-4" style="background-color: #1E1E1E; border-radius: 8px; padding: 20px;">
            <h2 style="border-bottom: 1px solid #444; padding-bottom:10px; margin-bottom:15px;">Pedido de: {{ data_restaurant.name }}</h2>
            <table class="table" style="color: #E0E0E0;">
                <thead>
                    <tr>
                        <th scope="col">Ítem</th>
                        <th scope="col" style="width: 120px;">Cantidad</th>
                        <th scope="col" class="text-right">Precio Unit.</th>
                        <th scope="col" class="text-right">Subtotal</th>
                        <th scope="col" style="width: 100px;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in data_restaurant.get('items', []) %}
                    <tr>
                        <td>{{ item.name }}</td>
                        <td>
                             
                            <form action="{{ url_for('update_cart_item', menu_item_id_str=item.id_str) }}" method="POST" class="d-flex">
                                <input type="number" name="quantity" value="{{ item.quantity }}" min="0" max="10" class="form-control form-control-sm" style="width: 60px; background-color: #2A2A2A; color: #E0E0E0; border: 1px solid #444; margin-right: 5px;">
                                <button type="submit" class="btn btn-sm btn-outline-light" style="color:#00D9C0; border-color:#00D9C0;">Actualizar</button>
                            </form>
                        </td>
                        <td class="text-right">${{ "{:,.2f}".format(item.price) }}</td>
                        <td class="text-right">${{ "{:,.2f}".format(item.subtotal) }}</td>
                        <td>
                            <form action="{{ url_for('remove_from_cart', menu_item_id_str=item.id_str) }}" method="POST">
                                <button type="submit" class="btn btn-sm btn-danger" style="background-color: #dc3545; color: white;">Eliminar</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <h4 class="text-right" style="margin-top: 15px;">Subtotal para {{ data_restaurant.name }}: ${{ "{:,.2f}".format(data_restaurant.subtotal) }}</h4>
            
            <div class="text-right mt-3">
                <form action="{{ url_for('checkout') }}" method="GET"> <input type="hidden" name="restaurant_id_for_checkout" value="{{ restaurant_id }}">
                    <button type="submit" class="btn btn-success" style="background-color: #00D9C0; color: #121212; border:none;">Proceder al Pago de este Restaurante</button>
                </form>
            </div>
        </div>
        {% endfor %}

        <hr style="margin: 30px 0;">
        <div class="text-right">
            <h3>Total General del Carrito: ${{ "{:,.2f}".format(total_cart_amount) }}</h3>
        </div>

    {% else %}
        <p class="lead">Tu carrito está vacío.</p>
        <p><a href="{{ url_for('list_restaurants') }}" class="btn btn-primary" style="background-color: #00D9C0; color: #121212; border:none;">Ver Restaurantes</a></p>
    {% endif %}
</div>
{% endblock %}